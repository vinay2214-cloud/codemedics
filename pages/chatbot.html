<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Symptom Checker - CodeMedics</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Malayalam:wght@400;600&family=Noto+Sans+Tamil:wght@400;600&family=Noto+Sans+Telugu:wght@400;600&family=Noto+Sans+Bengali:wght@400;600&family=Noto+Nastaliq+Urdu:wght@400;600&family=Noto+Sans+Devanagari:wght@400;600&display=swap" rel="stylesheet">
    <style>
        .chat-container {
            max-width: 600px;
            margin: 40px auto;
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        .symptom-btn {
            margin: 5px;
            padding: 10px 16px;
            border: 1px solid #e5e7eb;
            border-radius: 50px;
            background: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .symptom-btn:hover {
            background: #f3f4f6;
            transform: translateY(-1px);
        }
        .symptom-btn.selected {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1d4ed8;
        }
        #result {
            margin-top: 30px;
            padding: 20px;
            border-radius: 12px;
            display: none;
        }
        .alert-high {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #b91c1c;
        }
        .alert-medium {
            background: #ffedd5;
            border: 1px solid #fed7aa;
            color: #c2410c;
        }
        .alert-low {
            background: #ecfdf5;
            border: 1px solid #ccfbf1;
            color: #065f46;
        }
    </style>
</head>
<body>
    <header class="cm-header">
        <div class="container header-content">
            <a href="../index.html" class="brand-title">CodeMedics</a>
            <select id="language-switcher" class="lang-select">
                <option value="en">English</option>
                <option value="ml">р┤ор┤▓р┤пр┤╛р┤│р┤В</option>
                <option value="hi">рд╣рд┐рдиреНрджреА</option>
                <option value="ta">родрооро┐ро┤рпН</option>
                <option value="te">р░др▒Жр░▓р▒Бр░Чр▒Б</option>
                <option value="ur">╪з╪▒╪п┘И</option>
            </select>
        </div>
    </header>

    <main>
        <div class="chat-container">
            <h2 data-i18n="aiTitle">AI Health Assistant</h2>
            <p data-i18n="aiDesc">Select your symptoms. AI will analyze risk.</p>

            <div id="symptom-buttons">
                <!-- Buttons will be generated by JS -->
            </div>

            <div id="result">
                <h3 data-i18n="aiResult">Analysis Result</h3>
                <p id="risk-message"></p>
                <p id="action-message"></p>
            </div>

            <button id="submit-btn" class="cm-btn primary" style="margin-top: 20px; display: none;" data-i18n="submit">Submit & Notify Clinic</button>
        </div>
    </main>

    <script src="../assets/js/i18n.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const lang = localStorage.getItem('userLang') || 'en';
            translatePage(lang);

            // Symptom translations
            const symptomTranslations = {
                en: ["Fever", "Cough", "Headache", "Fatigue", "Body Pain", "Loss of Taste", "Shortness of Breath"],
                ml: ["р┤кр┤ир┤┐", "р┤Ър╡Бр┤о", "р┤др┤▓р┤╡р╡Зр┤жр┤и", "р┤Ер┤зр┤┐р┤Хр┤В р┤Хр╡Нр┤╖р╡Ар┤гр┤В", "р┤╢р┤░р╡Ар┤░р┤╡р╡Зр┤жр┤и", "р┤░р╡Бр┤Ър┤┐р┤Хр╡Зр┤Яр╡Н", "р┤╢р╡Нр┤╡р┤╛р┤╕р┤др┤Яр┤╕р╡Нр┤╕р┤В"],
                hi: ["рдмреБрдЦрд╛рд░", "рдЦрд╛рдВрд╕реА", "рд╕рд┐рд░рджрд░реНрдж", "рдердХрд╛рди", "рд╢рд░реАрд░ рджрд░реНрдж", "рд╕реНрд╡рд╛рдж рдХрд╛ рдиреБрдХрд╕рд╛рди", "рд╕рд╛рдВрд╕ рд▓реЗрдиреЗ рдореЗрдВ рддрдХрд▓реАрдл"],
                ta: ["роХро╛ропрпНроЪрпНроЪро▓рпН", "роЗро░рпБрооро▓рпН", "родро▓рпИро╡ро▓ро┐", "роЪрпЛро░рпНро╡рпБ", "роЙроЯро▓рпН ро╡ро▓ро┐", "роЪрпБро╡рпИ роЗро┤рокрпНрокрпБ", "роорпВроЪрпНроЪрпБродрпН родро┐рогро▒ро▓рпН"],
                te: ["р░Ьр▒Нр░╡р░░р░В", "р░жр░Чр▒Нр░Чр▒Б", "р░др░▓р░ир▒Кр░кр▒Нр░кр░┐", "р░Ер░▓р░╕р░Я", "р░╢р░░р▒Ар░░ р░ир▒Кр░кр▒Нр░кр░┐", "р░░р▒Бр░Ър░┐ р░Хр▒Лр░▓р▒Нр░кр▒Лр░╡р░бр░В", "р░Кр░кр░┐р░░р░┐ р░Жр░бр░Хр░кр▒Лр░╡р░бр░В"],
                ur: ["╪и╪о╪з╪▒", "┌й┌╛╪з┘Ж╪│█М", "╪│╪▒ ╪п╪▒╪п", "╪к┌╛┌й╪з┘И┘╣", "╪м╪│┘Е╪з┘Ж█М ╪п╪▒╪п", "╪░╪з╪ж┘В█Б ┌й╪з ┘Ж┘В╪╡╪з┘Ж", "╪│╪з█Б ┘Д█М┘Ж█Т ┘Е█М┌║ ╪п╪┤┘И╪з╪▒█М"]
            };

            // Risk logic (simulated AI)
            const getRiskAnalysis = (symptoms, lang) => {
                const highRiskCombos = [
                    ["Fever", "Cough", "Shortness of Breath"],
                    ["Fever", "Loss of Taste"],
                    ["Cough", "Shortness of Breath", "Fatigue"]
                ];

                const mediumRiskCombos = [
                    ["Fever", "Cough"],
                    ["Fever", "Headache", "Body Pain"],
                    ["Cough", "Fatigue"]
                ];

                // Check for high risk
                for (let combo of highRiskCombos) {
                    if (combo.every(s => symptoms.includes(s))) {
                        return {
                            level: "high",
                            message: {
                                en: "тЪая╕П High Risk: Possible TB or COVID. Urgent clinic visit required.",
                                ml: "тЪая╕П р┤Йр┤пр╡╝р┤ир╡Нр┤и р┤Ер┤кр┤Хр┤Яр┤╕р┤╛р┤зр╡Нр┤пр┤д: р┤╕р┤╛р┤зр╡Нр┤пр┤ор┤╛р┤п р┤Хр╡Нр┤╖р┤пр┤░р╡Лр┤Чр┤В р┤Ер┤▓р╡Нр┤▓р╡Жр┤Щр╡Нр┤Хр┤┐р╡╜ COVID. р┤Ер┤Яр┤┐р┤пр┤ир╡Нр┤др┤░ р┤Хр╡Нр┤▓р┤┐р┤ир┤┐р┤Хр╡Н р┤╕р┤ир╡Нр┤жр╡╝р┤╢р┤ир┤В р┤Жр┤╡р┤╢р╡Нр┤пр┤ор┤╛р┤гр╡Н.",
                                hi: "тЪая╕П рдЙрдЪреНрдЪ рдЬреЛрдЦрд┐рдо: рд╕рдВрднрд╛рд╡рд┐рдд рдЯреАрдмреА рдпрд╛ COVIDред рддрддреНрдХрд╛рд▓ рдХреНрд▓рд┐рдирд┐рдХ рдпрд╛рддреНрд░рд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред",
                                ta: "тЪая╕П роЙропро░рпН роЗроЯро░рпНрокро╛роЯрпБ: роЪро╛родрпНродро┐ропрооро╛рой роЯро┐.рокро┐ роЕро▓рпНро▓родрпБ COVID. роЕро╡роЪро░ роХро┐ро│ро┐ройро┐роХрпН рокро╛ро░рпНро╡рпИ родрпЗро╡рпИ.",
                                te: "тЪая╕П р░╣р▒И р░░р░┐р░╕р▒Нр░Хр▒Н: р░╕р░╛р░зр▒Нр░пр░ор▒Ир░и TB р░▓р▒Зр░жр░╛ COVID. р░Ер░др▒Нр░пр░╡р░╕р░░ р░Хр▒Нр░▓р░┐р░ир░┐р░Хр▒Н р░╕р░Вр░жр░░р▒Нр░╢р░и р░Ер░╡р░╕р░░р░В.",
                                ur: "тЪая╕П ╪з┘И┘Ж┌Ж╪з ╪о╪╖╪▒: ┘Е┘Е┌й┘Ж█Б ┘╣█М ╪и█М █М╪з ┌й┘И┘И┌И█Ф ┘Б┘И╪▒█М ┌й┘Д█М┘Ж┌й ┌й╪з ╪п┘И╪▒█Б ╪п╪▒┌й╪з╪▒ █Б█Т█Ф"
                            },
                            action: {
                                en: "Clinic & District Health Officer notified automatically.",
                                ml: "р┤Хр╡Нр┤▓р┤┐р┤ир┤┐р┤Хр╡Нр┤Хр╡Бр┤В р┤Ьр┤┐р┤▓р╡Нр┤▓р┤╛ р┤Жр┤░р╡Лр┤Чр╡Нр┤п р┤Ур┤лр╡Ар┤╕р┤▒р╡Бр┤В р┤пр┤╛р┤ир╡Нр┤др╡Нр┤░р┤┐р┤Хр┤ор┤╛р┤пр┤┐ р┤Ер┤▒р┤┐р┤пр┤┐р┤Хр╡Нр┤Хр┤кр╡Нр┤кр╡Жр┤Яр╡Нр┤Яр╡Б.",
                                hi: "рдХреНрд▓рд┐рдирд┐рдХ рдФрд░ рдЬрд┐рд▓рд╛ рд╕реНрд╡рд╛рд╕реНрдереНрдп рдЕрдзрд┐рдХрд╛рд░реА рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕реВрдЪрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ред",
                                ta: "роХро┐ро│ро┐ройро┐роХрпН рооро▒рпНро▒рпБроорпН рооро╛ро╡роЯрпНроЯ роЪрпБроХро╛родро╛ро░ роЕро▓рпБро╡ро▓ро░рпН родро╛ройро╛роХро╡рпЗ родрпЖро░ро┐ро╡ро┐роХрпНроХрокрпНрокроЯрпНроЯродрпБ.",
                                te: "р░Хр▒Нр░▓р░┐р░ир░┐р░Хр▒Н & р░Ьр░┐р░▓р▒Нр░▓р░╛ р░Жр░░р▒Лр░Чр▒Нр░п р░Ер░зр░┐р░Хр░╛р░░р░┐ р░╕р▒Нр░╡р░пр░Вр░Ър░╛р░▓р░Хр░Вр░Чр░╛ р░╣р▒Жр░Ър▒Нр░Ър░░р░┐р░Вр░Ър░мр░бр▒Нр░бр░╛р░░р▒Б.",
                                ur: "┌й┘Д█М┘Ж┌й ╪з┘И╪▒ ╪╢┘Д╪╣█М ╪╡╪н╪к ╪з┘Б╪│╪▒ ┌й┘И ╪о┘И╪п ╪и╪о┘И╪п ┘Е╪╖┘Д╪╣ ┌й█М╪з ┌п█М╪з█Ф"
                            }
                        };
                    }
                }

                // Check for medium risk
                for (let combo of mediumRiskCombos) {
                    if (combo.every(s => symptoms.includes(s))) {
                        return {
                            level: "medium",
                            message: {
                                en: "ЁЯЯб Medium Risk: Possible viral infection. Visit clinic within 24 hours.",
                                ml: "ЁЯЯб р┤ор┤┐р┤др┤ор┤╛р┤п р┤Ер┤кр┤Хр┤Яр┤╕р┤╛р┤зр╡Нр┤пр┤д: р┤╕р┤╛р┤зр╡Нр┤пр┤ор┤╛р┤п р┤╡р╡Ир┤▒р╡╜ р┤Ер┤гр╡Бр┤мр┤╛р┤з. 24 р┤ор┤гр┤┐р┤Хр╡Нр┤Хр╡Вр┤▒р┤┐р┤ир╡Бр┤│р╡Нр┤│р┤┐р╡╜ р┤Хр╡Нр┤▓р┤┐р┤ир┤┐р┤Хр╡Н р┤╕р┤ир╡Нр┤жр╡╝р┤╢р┤┐р┤Хр╡Нр┤Хр╡Бр┤Х.",
                                hi: "ЁЯЯб рдордзреНрдпрдо рдЬреЛрдЦрд┐рдо: рд╕рдВрднрд╛рд╡рд┐рдд рд╡рд╛рдпрд░рд▓ рд╕рдВрдХреНрд░рдордгред 24 рдШрдВрдЯреЗ рдХреЗ рднреАрддрд░ рдХреНрд▓рд┐рдирд┐рдХ рдЬрд╛рдПрдВред",
                                ta: "ЁЯЯб роироЯрпБродрпНродро░ роЗроЯро░рпНрокро╛роЯрпБ: роЪро╛родрпНродро┐ропрооро╛рой ро╡рпИро░ро╕рпН родрпКро▒рпНро▒рпБ. 24 роорогро┐роирпЗро░родрпНродро┐ро▒рпНроХрпБро│рпН роХро┐ро│ро┐ройро┐роХрпНроХро┐ро▒рпНроХрпБ роЪрпЖро▓рпНро▓ро╡рпБроорпН.",
                                te: "ЁЯЯб р░ор▒Ар░бр░┐р░пр░В р░░р░┐р░╕р▒Нр░Хр▒Н: р░╕р░╛р░зр▒Нр░пр░ор▒Ир░и р░╡р▒Ир░░р░▓р▒Н р░Зр░ир▒Нр░лр▒Жр░Хр▒Нр░╖р░ир▒Н. 24 р░Чр░Вр░Яр░▓р▒Нр░▓р▒Лр░кр▒Б р░Хр▒Нр░▓р░┐р░ир░┐р░Хр▒НтАМр░Хр▒Б р░╡р▒Жр░│р▒Нр░▓р░Вр░бр░┐.",
                                ur: "ЁЯЯб ╪п╪▒┘Е█М╪з┘Ж█М ╪о╪╖╪▒: ┘Е┘Е┌й┘Ж█Б ┘И╪з╪ж╪▒┘Д ╪з┘Ж┘Б█М┌й╪┤┘Ж█Ф 24 ┌п┌╛┘Ж┘╣┘И┌║ ┌й█Т ╪з┘Ж╪п╪▒ ┌й┘Д█М┘Ж┌й ╪м╪з╪ж█М┌║█Ф"
                            },
                            action: {
                                en: "Record saved. Clinic notified.",
                                ml: "р┤▒р╡Жр┤Хр╡Нр┤Хр╡Лр╡╝р┤бр╡Н р┤╕р┤Вр┤░р┤Хр╡Нр┤╖р┤┐р┤Ър╡Нр┤Ър╡Б. р┤Хр╡Нр┤▓р┤┐р┤ир┤┐р┤Хр╡Нр┤Хр╡Н р┤Ер┤▒р┤┐р┤пр┤┐р┤Ър╡Нр┤Ър╡Б.",
                                hi: "рд░рд┐рдХреЙрд░реНрдб рд╕рд╣реЗрдЬрд╛ рдЧрдпрд╛ред рдХреНрд▓рд┐рдирд┐рдХ рдХреЛ рд╕реВрдЪрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ред",
                                ta: "рокродро┐ро╡рпБ роЪрпЗрооро┐роХрпНроХрокрпНрокроЯрпНроЯродрпБ. роХро┐ро│ро┐ройро┐роХрпНроХро┐ро▒рпНроХрпБ родрпЖро░ро┐ро╡ро┐роХрпНроХрокрпНрокроЯрпНроЯродрпБ.",
                                te: "р░░р░┐р░Хр░╛р░░р▒Нр░бр▒Б р░╕р▒Зр░╡р▒Н р░Ър▒Зр░пр░мр░бр░┐р░Вр░жр░┐. р░Хр▒Нр░▓р░┐р░ир░┐р░Хр▒НтАМр░Хр▒Б р░ир▒Лр░Яр░┐р░лр▒И р░Ър▒Зр░пр░мр░бр░┐р░Вр░жр░┐.",
                                ur: "╪▒█М┌й╪з╪▒┌И ┘Е╪н┘Б┘И╪╕ ┌й█М╪з ┌п█М╪з█Ф ┌й┘Д█М┘Ж┌й ┌й┘И ┘Е╪╖┘Д╪╣ ┌й█М╪з ┌п█М╪з█Ф"
                            }
                        };
                    }
                }

                // Low risk
                return {
                    level: "low",
                    message: {
                        en: "ЁЯЯв Low Risk: Minor symptoms. Rest and hydrate.",
                        ml: "ЁЯЯв р┤Хр╡Бр┤▒р┤Юр╡Нр┤Ю р┤Ер┤кр┤Хр┤Яр┤╕р┤╛р┤зр╡Нр┤пр┤д: р┤Ър╡Жр┤▒р┤┐р┤п р┤▓р┤Хр╡Нр┤╖р┤гр┤Щр╡Нр┤Щр╡╛. р┤╡р┤┐р┤╢р╡Нр┤░р┤ор┤┐р┤Хр╡Нр┤Хр╡Бр┤Х, р┤Ьр┤▓р┤В р┤Хр┤┤р┤┐р┤Хр╡Нр┤Хр╡Бр┤Х.",
                        hi: "ЁЯЯв рдХрдо рдЬреЛрдЦрд┐рдо: рд╣рд▓реНрдХреЗ рд▓рдХреНрд╖рдгред рдЖрд░рд╛рдо рдХрд░реЗрдВ рдФрд░ рдкрд╛рдиреА рдкрд┐рдПрдВред",
                        ta: "ЁЯЯв роХрпБро▒рпИроирпНрод роЗроЯро░рпНрокро╛роЯрпБ: роЪро┐ро▒ро┐роп роЕро▒ро┐роХрпБро▒ро┐роХро│рпН. роУропрпНро╡рпЖроЯрпБроХрпНроХро╡рпБроорпН, родрогрпНрогрпАро░рпН роХрпБроЯро┐роХрпНроХро╡рпБроорпН.",
                        te: "ЁЯЯв р░др░Хр▒Нр░Хр▒Бр░╡ р░░р░┐р░╕р▒Нр░Хр▒Н: р░Ър░┐р░ир▒Нр░и р░▓р░Хр▒Нр░╖р░гр░╛р░▓р▒Б. р░╡р░┐р░╢р▒Нр░░р░╛р░Вр░др░┐ р░др▒Ар░╕р▒Бр░Хр▒Лр░Вр░бр░┐ р░ор░░р░┐р░пр▒Б р░╣р▒Ир░бр▒Нр░░р▒Зр░Яр▒Н р░Ър▒Зр░пр░Вр░бр░┐.",
                        ur: "ЁЯЯв ┌й┘Е ╪о╪╖╪▒: ┘Е╪╣┘Е┘И┘Д█М ╪╣┘Д╪з┘Е╪з╪к█Ф ╪в╪▒╪з┘Е ┌й╪▒█М┌║ ╪з┘И╪▒ ┘╛╪з┘Ж█М ┘╛█М╪ж█М┌║█Ф"
                    },
                    action: {
                        en: "No immediate action required.",
                        ml: "р┤Йр┤Яр╡╗ р┤ир┤Яр┤кр┤Яр┤┐ р┤Жр┤╡р┤╢р╡Нр┤пр┤ор┤┐р┤▓р╡Нр┤▓.",
                        hi: "рддрддреНрдХрд╛рд▓ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред",
                        ta: "роЙроЯройроЯро┐ роироЯро╡роЯро┐роХрпНроХрпИ родрпЗро╡рпИропро┐ро▓рпНро▓рпИ.",
                        te: "р░др░Хр▒Нр░╖р░г р░Ър░░р▒Нр░п р░Ер░╡р░╕р░░р░В р░▓р▒Зр░жр▒Б.",
                        ur: "┘Б┘И╪▒█М ┌й╪з╪▒╪▒┘И╪з╪ж█М ┌й█М ╪╢╪▒┘И╪▒╪к ┘Ж█Б█М┌║ █Б█Т█Ф"
                    }
                };
            };

            // Generate symptom buttons
            const symptomBtns = document.getElementById('symptom-buttons');
            const symptoms = symptomTranslations[lang] || symptomTranslations['en'];
            const englishSymptoms = symptomTranslations['en'];

            symptoms.forEach((label, i) => {
                const btn = document.createElement('button');
                btn.className = 'symptom-btn';
                btn.textContent = label;
                btn.dataset.symptom = englishSymptoms[i]; // Store English key for logic
                btn.addEventListener('click', function() {
                    this.classList.toggle('selected');
                    document.getElementById('submit-btn').style.display = 'block';
                });
                symptomBtns.appendChild(btn);
            });

            // Handle submit
           document.getElementById('submit-btn').addEventListener('click', async () => {
    const selectedBtns = document.querySelectorAll('.symptom-btn.selected');
    const selectedSymptoms = Array.from(selectedBtns).map(btn => btn.dataset.symptom);

    if (selectedSymptoms.length === 0) {
        alert("Please select at least one symptom.");
        return;
    }

    const analysis = getRiskAnalysis(selectedSymptoms, lang);

    // SIMULATE: In real app, youтАЩd get Health ID from QR scan or login
    const mockHealthId = "CM-ABC123"; // Replace with real ID in production

    try {
        // Save to backend
        const recordResponse = await fetch('http://localhost:5000/api/records', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                health_id: mockHealthId,
                symptoms: selectedSymptoms.join(','),
                risk_level: analysis.level,
                notes: "AI Symptom Checker Report"
            })
        });

        const recordResult = await recordResponse.json();

        if (recordResult.success) {
            const resultDiv = document.getElementById('result');
            const riskMsg = document.getElementById('risk-message');
            const actionMsg = document.getElementById('action-message');

            resultDiv.className = `alert-${analysis.level}`;
            resultDiv.style.display = 'block';
            riskMsg.textContent = analysis.message[lang] || analysis.message['en'];
            actionMsg.textContent = analysis.action[lang] || analysis.action['en'];

            setTimeout(() => {
                alert("тЬЕ Health record saved to server!");
            }, 1000);
        }
    } catch (error) {
        alert("Failed to save record. Is backend running?");
        console.error(error);
    }

    </script>
</body>
</html>
